# _*_ MakeFile _*_

##############################################################################
# VARIABLES
##############################################################################

# ----------------------------------------------------------------------------
# Default compiler
# ----------------------------------------------------------------------------
CC := clang

# ----------------------------------------------------------------------------
# Default compiler flags
# ----------------------------------------------------------------------------
INCDIRS := -I.
OPTIM := -O2
CFLAGS := -std=c99 -fstrict-aliasing $(OPTIM) $(INCDIRS)

# ----------------------------------------------------------------------------
# Files
# ----------------------------------------------------------------------------
SRCS := main.c buyer.c order.c
ASMS := $(patsubst %.c, %.s, $(SRCS))
OBJS := $(patsubst %.c, %.o, $(SRCS))


##############################################################################
# COMMANDS
##############################################################################

all: order $(ASMS)

# ----------------------------------------------------------------------------
# Executable
# ----------------------------------------------------------------------------
order: $(OBJS)
	$(CC) -o $@ $^ $(CFLAGS)

# ----------------------------------------------------------------------------
# Generate assembly files
# ----------------------------------------------------------------------------
%.o: %.c
	$(CC) -o $@ -c $< $(CFLAGS)

# ----------------------------------------------------------------------------
# Generate assembly files using `clang` with optimization options
# ----------------------------------------------------------------------------
%.s: %.c
	$(CC) -o $@ -S $< $(CFLAGS)

# ----------------------------------------------------------------------------
# Clean
# ----------------------------------------------------------------------------
.PHONY: clean
clean:
	rm -f $(ASMS) $(OBJS) order

